# 用户相关问题

本文主要介绍用户相关问题的报错信息和处理方法。

## 用户被锁报错

对于多次登录失败的用户，OceanBase 数据库会锁定该用户，以便防止恶意的密码攻击，从而保护数据库，提升数据库的安全性。

### 报错信息

例如，使用用户 `ny1` 登录到数据库的 Oracle 租户，系统报错，提示用户被锁。

```sql
[admin@k08j13249.eu95sqa /home/admin]
$obclient -h10.0.0.0 -P2881 -uny@Oracle -p -A
Enter password:
ERROR 3118 (HY000): User locked
```

### 处理方法

1. 使用管理员用户登录到相应的租户。Oracle 租户默认的管理员用户为 `SYS` 用户。

   >**说明**
   >
   >解锁用户的操作一般由管理员完成，普通用户如果需要执行解锁操作，必须具备全局 `ALTER USER` 权限。

   ```sql
   [admin@k08j13249.eu95sqa /home/admin]
   $obclient -h10.10.10.1 -P2881 -usys@Oracle -p -A
   Enter password:
   Welcome to the OceanBase.  Commands end with ; or \g.
   Your OceanBase connection id is 3221584177
   Server version: OceanBase 4.0.0.0 (r100000172022101218-6ab80a3950710941946c004d805fcfded7a4aa2c) (Built Oct 12 2022 18:43:39)

   Copyright (c) 2000, 2018, OB Corporation Ab and others.

   Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
   ```

2. 解锁用户 `ny`。

   ```sql
    obclient [SYS]> ALTER USER ny ACCOUNT UNLOCK ;
   Query OK, 0 rows affected
   ```

3. 再次使用 `ny` 用户登录。

   ```sql
   [admin@k08j13249.eu95sqa /home/admin]
   $obclient -h10.10.10.1 -P2881 -uny@Oracle -p -A
   Enter password:
   Welcome to the OceanBase.  Commands end with ; or \g.
   Your OceanBase connection id is 3221584177
   Server version: OceanBase 4.0.0.0 (r100000172022101218-6ab80a3950710941946c004d805fcfded7a4aa2c) (Built Oct 12 2022 18:43:39)

   Copyright (c) 2000, 2018, OB Corporation Ab and others.

   Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
   ```

## 用户密码错误报错

### 错误信息

例如，用户 `ny` 登录数据库时，忘记了密码，导致密码输入错误，报错。

```sql
[admin@k08j13249.eu95sqa /home/admin]
$obclient -h10.0.0.0 -P2881 -uny@Oracle -p -A
Enter password:
ERROR 1045 (42000): Access denied for user 'NY'@'xxx.xxx.xxx.xxx' (using password: YES)
```

## 处理方法

1. 使用管理员用户登录到相应的租户。Oracle 租户默认的管理员用户为 `SYS` 用户。

   >**说明**
   >
   >解锁用户的操作一般由管理员完成，普通用户如果需要执行解锁操作，必须具备全局 `ALTER USER` 权限。

   ```sql
   [admin@k08j13249.eu95sqa /home/admin]
   $obclient -h10.10.10.1 -P2881 -usys@Oracle -p -A
   Enter password:
   Welcome to the OceanBase.  Commands end with ; or \g.
   Your OceanBase connection id is 3221584177
   Server version: OceanBase 4.0.0.0 (r100000172022101218-6ab80a3950710941946c004d805fcfded7a4aa2c) (Built Oct 12 2022 18:43:39)

   Copyright (c) 2000, 2018, OB Corporation Ab and others.

   Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
   ```

2. 修改 `ny` 用户的密码。

   ```sql
    obclient [SYS]> ALTER USER ny IDENTIFIED BY ***3***;
   Query OK, 0 rows affected
   ```

   >**说明**
   >
   >为用户设置密码时，用户密码需要符合当前租户的密码复杂度。密码复杂度相关操作及说明请参见 [设置密码复杂度](../../../7.reference/2.manage-guide/2.basic-database-management/4.manage-tenants-1/5.manage-users-and-permissions/2.oracle-3/2.set-password-complexity.md)。

3. 再次使用 `ny` 用户登录。

   ```sql
   [admin@k08j13249.eu95sqa /home/admin]
   $obclient -h10.10.10.1 -P2881 -uny@Oracle -p -A
   Enter password:
   Welcome to the OceanBase.  Commands end with ; or \g.
   Your OceanBase connection id is 3221584177
   Server version: OceanBase 4.0.0.0 (r100000172022101218-6ab80a3950710941946c004d805fcfded7a4aa2c) (Built Oct 12 2022 18:43:39)

   Copyright (c) 2000, 2018, OB Corporation Ab and others.

   Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
   ```

## 相关阅读

* [登录失败处理策略](../../../7.reference/2.manage-guide/2.basic-database-management/4.manage-tenants-1/5.manage-users-and-permissions/2.oracle-3/3.logon-failure-handling-policy.md)

* [设置密码复杂度](../../../7.reference/2.manage-guide/2.basic-database-management/4.manage-tenants-1/5.manage-users-and-permissions/2.oracle-3/2.set-password-complexity.md)


# 查看合并过程

# docslug#/oceanbase-database/oceanbase-database/V4.0.0/view-merge-process
发起合并后，您可以通过内部表来查看合并过程。

合并的过程可以通过内部表进行查看，通常合并的时间是取决于两次合并之间的数据变化量。两次合并之间的数据变化大，合并的时间会更长。同时，合并的线程数、合并时的集群压力以及是否轮转合并等都影响合并的时间长短。

## 通过视图查看合并过程

您可以通过查询 `DBA_OB_ZONE_MAJOR_COMPACTION` 来观察合并过程。

1. 使用 `root`用户登录数据库的 `sys` 租户。

2. 进入 `oceanbase` 数据库。

   ```sql
   obclient> USE oceanbase;
   ```

3. 执行以下语句，查看合并进度。

   ```sql
   obclient> SELECT * FROM DBA_OB_ZONE_MAJOR_COMPACTION\G
   *************************** 1. row ***************************
               ZONE: zone1
   BROADCAST_VERSION: 1
      LAST_VERSION: 1
   LAST_FINISH_TIME: 1970-01-01 08:00:00.000000
         START_TIME: 1970-01-01 08:00:00.000000
            STATUS: IDLE
            IS_ERROR: NO
               INFO: 
   1 row in set (0.01 sec)
   ```

   在执行结果中观察 `status` 列，部分参数的说明如下表所示。

   |参数|说明|
   |---|---|
   |ZONE|Zone 名称。|
   |BROADCAST_SCN|广播的合并版本号。|
   |LAST_SCN|上一次合并的版本号。|
   |LAST_FINISH_TIME|上一次合并结束时间。|
   |START_TIME|合并开始时间。|
   |STATUS|合并状态：<ul><li>IDLE：未在合并中</li>   <li>COMPACTING：正在合并中</li>   <li>VERIFYING：正在校验 Checksum 中</li></ul>|
   |IS_ERROR|表示合并是否出错，如果有出错，需要高优先级处理。|

## 通过 OCP 查看合并过程

发起合并后，也可以通过 OCP 来查看合并过程。

1. 登录 OCP 。默认进入 **集群** 页面。

2. 在 **集群** 页面的 **集群列表** 区域，选择待操作的集群并单击其集群名。

3. 在显示的页面的左侧导航栏上，单击 **合并管理** 。

4. 在 **合并详情** 页签中，查看合并详情。

   ![p168813](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5249902261/p275810.png)

   合并详情一般显示的是集群最近的一次合并。如果当前正在合并，则展示合并中的版本，如果当前是空闲状态即未处于合并状态，则显示上一次合并版本详情。

   >**说明**
   >
   >对于合并中的版本，合并的 **开始时间** 和 **结束时间** 后显示的是预计完成时间。预计完成时间是基于最近三次合并完成的平均值来估算的，可能与实际合并完成时间有较大偏差

   一般而言，对于稳定运行的环境，预计完成时间会比较准确，新部署的环境因为估算的数据缺失，估算的准确度会较低。

   此外，您还可以通过 **总分区副本数** 和 **完成合并的分区副本数** 来观察分区级别的合并完成情况，推测实际的合并完成进度。

   >**注意**
   >
   >基于完成合并的分区副本数来直接计算合并完成进度仍然不准确，因为不同分区的大小差异可能很大，每个分区合并的耗时也可能差异很大。

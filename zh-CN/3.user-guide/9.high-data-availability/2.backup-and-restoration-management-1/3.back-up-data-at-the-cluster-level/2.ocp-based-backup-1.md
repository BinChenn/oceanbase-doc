通过 OCP 备份（集群级别） 
====================================
#docslug#/oceanbase-database/oceanbase-database/V4.0.0/ocp-based-backup-1
OCP 提供了白屏化的集群级备份操作。

定时备份 
-------------------------

在 OCP 上，您可以对需要备份的集群新建备份策略，以便后续根据该备份策略定时启动备份。

1. 登录 OCP。

   

2. 在左导航栏中单击 **备份恢复** **\>** **备份** 。

   

3. 在 **备份** 页面，单击右上角的 **新建备份策略** 。

   

4. 在下拉框中选择备份集群。

   本文档以待备份的集群为 V3.2.2 版本且备份方式为物理备份为例，提供操作指导。
   

5. 填写如下参数设置存储配置，并单击 **测试** 。

   

   |     参数     |                                                                                     说明                                                                                     |
   |------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
   | 存储配置名称     | 可自定义也可选择已有配置。 * 自定义时，需参考下述参数配置。   * 选择已有配置时，单击 **选择已有配置** 下述参数会自动填充。    |
   | 存储类型       | 备份文件存储介质，取值范围： * OSS：云存储。   * File：硬件设备存储。                              |
   | 存储目录       | 备份文件存储目录。                                                                                                                                                                  |
   | 备份存储容量报警阈值 | 默认值为 80%，当备份存储容量超过该值时报警。                                                                                                                                                   |
   | 访问域名       | **存储类型** 选择 OSS 时展示，填写访问云存储端的域名。                                                                                                                                           |
   | 访问用户       | **存储类型** 选择 OSS 时展示，填写访问云存储端的用户。                                                                                                                                           |
   | 访问秘钥       | **存储类型** 选择 OSS 时展示，填写访问云存储端的用户秘钥。                                                                                                                                         |

   

   ![新建备份策略](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6568358461/p277329.png)
   

6. 设置调度配置：

   * 调度周期：以周或月为周期，当调度周期为月时，最多只能选择 10 天。

     
   
   * 物理备份必须打开日志备份，且不可关闭。![2](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4120572161/p240040.png)
   

   

   

7. 设置过期备份清理调度配置。

   开启自动备份清理功能，并配置备份的过期天数。
   **说明**

   

   当存储配置为 OSS 时，暂不支持通过 OCP 来自动清理过期备份，但是您可以通过 SQL 语句来完成过期备份的清理，详细操作请参见 [自动清理备份的数据](../3.back-up-data-at-the-cluster-level/7.automatically-delete-backed-up-data-1.md)。

   ![过期备份清理配置](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6924117361/p352008.png)
   

8. 设置报警阈值配置，您可对数据备份超时报警阈值、日志备份延时报警阈值、无成功数据备份报警天数进行配置，配置成功后，当实际输出超过阈值，将会受到告警提示。![1](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/4120572161/p240038.png)

   

9. （可选）配置二次备份。

   二次备份即备份备份功能，如果您需要配置二次备份，可以打开二次备份开关并进行配置，如果暂时不需要，可以待需要进行二次备份时，再配置二次备份，相关操作请参见 [通过 OCP 备份备份](../4.back-up-the-backed-up-data/3.backup-via-ocp-backup-cluster-level.md)。
   **说明**

   

   开启二次备份时，系统默认会自动开启日志分片功能。
   1. 配置二次备份的调度。

      ![09221429](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/2859542361/p328243.png)
      
   
   2. 配置二次备份的存储。

      ![09071926](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/3526591361/p324487.png)
      **说明**

      

      二次备份与普通备份的存储地址需不同，二次备份是对已有的备份进行再备份，为了保证灾难影响到普通备份的数据时，还有二次备份的数据可保障 OceanBase 数据库可恢复。
      
   

   

10. 单击 **提交，** 完成备份策略创建。

    




立即备份 
-------------------------

在 OCP 上，您也可以创建立即备份任务后可以立即发起备份。

1. 登录 OCP。

   

2. 单击左导航栏 **备份恢复** **\>** **备份** ，在页面右上方单击 **立即备份** 。

   

3. 选择备份集群。

   在下拉框中选择需要备份的集群，此时系统自动填充 **存储配置** 。
   

4. 单击 **测试** ，测试存储配置。

   

5. 选择数据备份方式。

   物理备份时需选择数据备份方式，逻辑备份时仅支持全量备份。
   **注意**

   
   * 在进行物理备份的增量备份前，必须要有一次全量的数据备份，否则 `Pre check` 步骤会报错提示"full data backup needed before incremental data backup."

     
   
   * 在进行物理备份的全量备份前，必须执行一次合并，否则 `Pre check` 步骤会报错提示"Cluster compaction needed before full data backup"。

     
   

   
   

6. 单击 **立即备份** 。

   




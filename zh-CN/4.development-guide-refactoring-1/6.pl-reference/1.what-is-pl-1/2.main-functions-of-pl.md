PL 的主要功能 
=============================
#docslug#/oceanbase-database/oceanbase-database/V4.0.0/main-functions-of-pl
PL 将 SQL 的数据处理能力与过程语言的处理能力相结合，并支持直接处理 SQL 语句，而无需学习新的 API。

与其他过程编程语言一样，PL 允许声明常量和变量、控制程序流、定义子程序以及捕获运行错误。

异常处理 
-------------

PL 可以便捷的检测和处理错误。

当发生错误时，PL 会报告异常。当前执行任务被停止，并对相应的 PL 块进行异常处理。所以使用 PL 的时候不必像 C 程序那样对每个操作进行排查。

PL 块 
-------------

PL 源程序的基本单元是块，由声明和语句组成。

PL 块由关键字 `DECLARE`、`BEGIN`、`EXCEPTION` 和 `END` 来定义。这些关键字将块分为声明部分、可执行部分和异常处理部分，其中，仅可执行部分是必需的。PL 块可以设置标签。

声明是本地属性，在块执行完后不再存在，这有助于避免变量和子程序的命名空间混乱。

块可以被嵌套。由于块是可执行语句，因此它可以出现其他块的可执行语句中。

您可以将块提交给交互式工具（例如 OBClient）或者迁入到程序中，该块在交互式工具或程序中只运行一次，不存储于数据库中，所以被称为匿名块。

变量和常量 
--------------

PL 允许声明变量和常量，并可以在表达式中使用。

在程序运行时，变量的值可以更改，但是常量的值不能更改。

程序包 
------------

程序包由逻辑上相关的 PL 类型、变量、常量、子程序、游标和异常组成。

程序包被编译并存储在数据库中，所以可以将程序包视为一种应用程序。

您可以编写自己的程序包， 还可以使用 OceanBase 数据库自带的系统包。

触发器 
------------

触发器是一个已命名的 PL 单元，它存储在数据库中，并运行响应数据库中发生的事件。

您可以指定触发器是在某一事件之前还是之后触发，以及触发器是针对每个事件还是该事件的每一行运行。 例如，可以创建一个触发器，该触发器在 t1 表每次执行 `INSERT` 语句时运行。

输入输出 
-------------

大多数 PL 输入和输出（I/O）是通过将数据存储在表中或查询表的 SQL 语句完成的。而其他的 PL I/O 均由 OceanBase 数据库提供的 PL 系统包完成。

当前版本支持的 PL I/O 处理系统包只有 `DBMS_OUTPUT`，所以需要使用 OBClient 显示 `DBMS_OUTPUT` 的输出信息，并先执行命令 `SET SERVEROUTPUT ON`。

数据抽象 
-------------

数据抽象使您可以处理数据的基本属性，而无需过多地研究其细节。

例如，可以先设计一个数据结构，然后设计它的算法。

**游标** 

当 OceanBase 数据库执行一个 SQL 语句时，它将结果集和处理信息保存在一块未命名的私有内存区域，并设置一个指针指向这块内存区域起始值。这个指针就是 **游标** 。使用游标，每次可以获取一行记录，游标属性会返回游标的状态信息。

**复合变量** 

PL 包括两种复合变量，即集合和记录。整个复合变量可以作为参数传递给子程序。

在集合中，内部组件始终是相同的数据类型，被称为元素。 您可以通过每个元素的唯一索引来访问它们。集合一般包括列表和数组。

在记录中，内部组件可以具有不同的数据类型，被称为字段。 您可以按名称访问每个字段。记录变量可以保留表行或表行中的某些列。

**使用 ％ROWTYPE 属性** 

`％ROWTYPE` 属性可以用来声明代表数据库表或视图里一行的记录类型。

对于完整或部分行的每一列，记录都有一个具有相同名称和数据类型的字段。如果行的结构发生变化，那么记录的结构也会发生变化。

**使用 %TYPE 属性** 

`％TYPE` 属性可以用来声明与先前声明的变量或列具有相同数据类型的数据项（而无需知道该类型是什么）。

如果被引用项目的声明有更改，那么该引用项目的声明也会相应更改。`％TYPE` 属性可以用于声明变量以保留数据库值。

**抽象数据类型** 

抽象数据类型（ADT）由数据结构和操作数据的子程序组成。

形成数据结构的变量称为属性（Attributes）。操纵属性的子程序称为方法（Methods）。ADT 存储在数据库中。ADT 的实例可以存储在表中并用作 PL 变量。

通过 ADT 可以将大型系统分成多个逻辑组件，以降低复杂性，这些逻辑组件可以重复使用。

在静态数据字典视图 `* _OBJECTS` 中，ADT 的 `OBJECT_TYPE` 为 `TYPE`。在静态数据字典视图 `* _TYPES` 中，ADT 的 `TYPECODE` 为 `OBJECT`。

控制语句 
-------------

控制语句是 SQL 的最重要的 PL 扩展。

PL 具有以下三类控制语句：

* 条件选择语句：为不同的数据值运行不同的语句。

  

* 循环语句：使用一系列不同的数据值重复相同的语句。

  

* 顺序控制语句：转到指定的带标签的语句，或着不执行任何操作。

  




单次处理多行查询结果 
-------------------

PL 可以发送 SQL 查询并一次处理多行结果。

您可以使用基本循环，也可以通过使用单个语句完成运行查询、检索结果并进行处理。

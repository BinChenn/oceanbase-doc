备集群解耦相关的问题 
===============================

在验证备集群是否具备解耦条件的过程中，执行 `DISCONNECT` 命令后，系统可能会提示执行失败的信息，本节主要列举可能的失败信息及原因。

报错信息 1：cluster id mismatch, disconnect cluster is not allowed 
----------------------------------------------------------------------------------

### 可能原因 

命令中指定的备集群的 `cluster_id` 不正确。

### 处理方法 

查询 `V$OB_CLUSTER` 视图，获取正确的备集群的 `cluster_id`。

示例如下：

```sql
obclient> SELECT cluster_id FROM oceanbase.V$OB_CLUSTER;
+------------+
| CLUSTER_ID |
+------------+
|          2 |
+------------+
1 row in set
```



报错信息 2：have inactive server, disconnect cluster is not allowed 
-----------------------------------------------------------------------------------

### 可能原因 

如果备集群上有 OBServer 不在线，则目前不支持解耦备集群。

### 处理方法 

保证备集群中的所有 OBServer 都在线后再执行解耦命令。

报错信息 3：cluster name mismatch, disconnect cluster is not allowed 
------------------------------------------------------------------------------------

### 可能原因 

命令中指定的备集群的集群名不正确。

### 处理方法 

查询 `V$OB_CLUSTER` 视图，获取正确的集群名。

示例如下：

```sql
obclient> SELECT cluster_name FROM oceanbase.V$OB_CLUSTER;
+-----------------+
| CLUSTER_NAME    |
+-----------------+
| cluster_name    |
+-----------------+
1 row in set
```



报错信息 4：cluster name conflict 
-------------------------------------------------

### 可能原因 

解耦命令中指定的集群名和原集群名冲突。

### 处理方法 

请尝试更换新的集群名后再查看是否冲突。

报错信息 5：cluster role is not STANDBY, disconnect cluster is not allowed 
------------------------------------------------------------------------------------------

### 可能原因 

该集群为主集群，目前不支持解耦主集群。

### 处理方法 

请切换备集群后再尝试解耦。

报错信息 6：switchover_status is incorrect, disconnect cluster is not allowed 
---------------------------------------------------------------------------------------------

### 可能原因 

当备集群处于 Switchover 或 Failover 状态时，不支持解耦备集群。

### 处理方法 

等待 Switchover 或 Failover 完成。

报错信息 7：cluster is in upgrade mode, disconnect cluster is not allowed 
-----------------------------------------------------------------------------------------

### 可能原因 

备集群处于升级状态，不支持解耦备集群。

### 处理方法 

等待备集群升级完成。

报错信息 8：protection level is not MAXIMUM PERFORMANCE, disconnect cluster is not allowed 
----------------------------------------------------------------------------------------------------------

### 可能原因 

备集群的保护级别不是最大性能级别，不支持解耦备集群。

### 处理方法 

当备集群的保护级别不是最大性能级别时，如果需要执行解耦命令，有以下两种场景：

* 主集群可用，且备集群的保护级别不是最大性能级别，说明备集群与主集群处于同步传输日志模式，为了防止解耦后主集群停写，需要先更改集群的保护模式为最大性能模式，然后再对该备集群执行解耦操作。

  

* 主集群不可用，则可以通过在解耦命令中添加 `FORCE` 关键字，强制对备集群执行解耦命令。

  




报错信息 9：primary cluster is still alive and in protection, disconnect cluster is not allowed 
---------------------------------------------------------------------------------------------------------------

### 可能原因 

如果备集群的保护级别没有处于最大性能级别，当主集群可用的情况下，即使在解耦命令中增加了 `FORCE` 关键字，为了防止解耦后主集群停写，也不能执行解耦命令。

### 处理方法 

修改集群的保护模式为最大性能模式，具体操作请参见 [切换保护模式](/zh-CN/5.administrator-guide/7.high-data-availability/3.active-standby-database-management-1/6.protection-mode-2/3.switch-protection-mode-1.md)。

通过 OCP 部署备集群 
=================================

您也可以通过 OCP 部署备集群。

前提条件 
-------------------------

部署备集群前，您需要了解以下信息：

* 部署备集群时，系统会自动从主集群同步全量数据，整个过程对带宽有要求，在正常同步过程中，仅同步 REDO 日志，相当于加了一个备副本。

  

* 备集群的版本一般要求与主集群版本一致，如果需要升级版本，OCP 支持主备集群滚动升级，即一次升级任务中会同时升级主集群和备集群，升级顺序为先升级备集群，再升级主集群。

  版本升级相关内容请参见 [OceanBase 数据库 升级指南](https://www.oceanbase.com/docs/oceanbase-database/oceanbase-database/V3.1.2/upgrade-overview)
  




背景信息 
-------------------------

不同 OCP 版本的操作界面可能不同，本节以 OCP V3.1.0 版本为例提供操作指导，OCP 其他版本的操作请参考对应版本的《 OCP 用户指南》文档。

操作步骤 
-------------------------

1. 登录 OCP 。

   默认进入 **集群概览** 页面。
   

2. 您可以通过以下2种方式进入创建备集群的页面。

   * 在 **集群概览** 页面的右上角，单击 **新建集群** ，然后在 **新建集群** 页面，选择 **集群类型** 为 **备集群** ，并在 **主集群** 列表中选择对应的主集群。

     
   
   * 在 **集群概览** 页面的 **集群列表** 区域，选择待添加备集群的集群并单击其集群名，单击 **总览** 页面的右上角，选择 **新建备集群** 。

     
   

   

3. 在 **新建集群** 页面，设置备集群的部署模式。

   默认是添加3个Zone的信息，如果您希望部署的集群Zone的个数大于3个，您可以在下方单击 **新增** 按钮，增加Zone信息。

   如果部署的集群Zone的个数小于3个，您可以单击Zone后面的删除图标。![p199912](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/6253991261/p277450.png)每个 Zone需要配置的信息及说明如下表所示。
   

   |      **配置**       |                                                               **描述**                                                               |
   |-------------------|------------------------------------------------------------------------------------------------------------------------------------|
   | **Zone 名称**       | 一般会有一个默认名称，您可以根据需要自定义名称。                                                                                                           |
   | **机房**            | Zone 所在的机房，每个 Zone 只能部署在同一个机房。                                                                                                     |
   | **机型**            | 可选项。 如果选择了机型，后面主机列表会根据机型进行过滤。                                                                                      |
   | **机器选择方式**        | 可以选择 **自** **动分配** 或者 **手动选择** 。                                                                                                   |
   | **IP**            | 您可以选择多个 IP。 如果 **机器选择方式** 是 **自动分配** ，则只需要输入机器的数量，OCP 会自动选择相应数量的可用机器；如果 **机器选择方式** 是 **手动选择** ，则需要您手动从列表中选择若干个 IP。 |
   | **Root Server位置** | 您可以选择一个 IP 作为 Root Server 所在的机器。                                                                                                   |

   

   

4. 完成后，单击 **提交** 。

   

5. 在弹出的 **确认提交信息** 对话框中，确认信息无误后，单击 **确定** 。

   




新建备集群后，备集群会选取最近一次 Major 版本作为快照，创建各普通租户下的系统表和用户表分区副本，初始化日志流，并选出分区 Leader 后，各个分区的 Leader 副本会自动从主集群拷贝指定快照版本的全量数据，同步到多数派副本，之后再自动同步 REDO 日志，直到与主集群保持同步。


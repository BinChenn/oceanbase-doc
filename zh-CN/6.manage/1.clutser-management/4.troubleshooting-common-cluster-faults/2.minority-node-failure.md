# 少数派节点故障

本节主要介绍少数派节点故障的故障处理流程。

## 少数派节点故障处理流程

当发生节点异常，或者怀疑节点异常时，需要隔离并替换该异常节点，具体操作如下：

1. 使用 `root` 用户登录到数据库的 `sys` 租户。

   连接示例如下，连接数据库时请以实际环境为准。

   ```shell
   [admin@xxx oceanbase]$ obclient -h10.xx.xx.xx -P2883 -uroot@sys -p***** -A
   ```

2. 尽快对异常节点执行 Stop Server 或 Force Stop Server 操作，并确保执行成功，避免影响业务流量。

   Stop Server 的语句如下：

   ```sql
   ALTER SYSTEM STOP SERVER 'ip:port'; 
   ```

   示例：

   ```sql
   obclient [none]> ALTER SYSTEM STOP SERVER 'xx.xx.xx.10:2882'; 
   ```

   Force Stop Server 的语句如下：

   ```sql
   ALTER SYSTEM FORCE STOP SERVER 'ip:port'; 
   ```

   示例：

   ```sql
   obclient [none]> ALTER SYSTEM FORCE STOP SERVER 'xx.xx.xx.10:2882'; 
   ```

   Stop Server 和 Force Stop Server 操作的内部执行流程相关信息请参见 [隔离节点](../3.common-cluster-operations/4.isolation-a-node.md)。

3. 在异常节点所在的 Zone 增加节点。

    增加节点的具体操作请参见 [增加节点](../3.common-cluster-operations/2.add-a-node.md)。

4. 在新增节点上补全异常节点上的副本的流程，分为以下三种场景：

   1. observer 进程已经退出的场景

      您可以主动发起 Unit 迁移，或者等待 RS 调度自动发起 Unit 迁移。如果超过永久下线时间手动迁移 Unit 仍然没有成功，Unit 迁移会自动完成，然后自动走补副本逻辑。
  
   2. 数据异常，或者进程状态异常导致迁移 Unit 操作卡住，或者进程状态异常导致全局状态异常（例如，合并卡住）的场景

      您可以主动 kill observer 进程，然后参考第一种场景处理。

   3. 硬件隐患，以及不会导致集群全局状态异常的场景

      该场景不需要 Kill observer 进程（避免 Kill observer 后导致的集群风险敞口变大）。您可以主动发起 Unit 迁移，将异常节点上的 Unit 全部迁移至新增节点。

   操作结束后，可以通过内部表查看数据补全进度。

5. 待异常节点上的 Unit 在新增节点上补全后，删除异常节点。

   删除节点的具体操作请参见 [删除节点](../3.common-cluster-operations/3.delete-a-node.md)。

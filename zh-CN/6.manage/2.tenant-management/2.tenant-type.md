# 租户类型

OceanBase 4.0 开始，有三种类型的租户：系统租户、用户租户以及每个用户租户对应的 Meta 租户。

## 租户类型介绍

* 系统租户

  系统租户是集群默认创建的租户，与集群生命期一致，负责管理集群和所有租户的生命周期。系统租户仅有一个 1 号日志流，只支持单点写入，不具备扩展能力。系统租户可以创建用户表，所有的用户表和系统表数据均由 1 号日志流服务。系统租户数据是集群私有的，不支持主备集群物理同步和物理备份恢复。

* 用户租户

  与系统租户对应的是用户租户，用户租户是由用户创建的租户，对外提供完整的数据库功能，支持 MySQL 和 Oracle 两种兼容模式。用户租户支持服务能力水平扩展到多台机器上，支持动态扩容和缩容，内部会根据用户配置自动创建和删除日志流。用户租户的数据有更强的数据保护和可用性要求，支持跨集群物理同步和物理备份恢复，典型数据包括：schema 数据、用户表数据、事务数据等。

* Meta 租户

  Meta 租户是 OceanBase 数据库内部自管理的租户，每创建一个用户租户会创建一个对应的 Meta 租户，其生命周期与用户租户保持一致。Meta 租户用于存储和管理用户租户的集群私有数据，这部分数据不需要跨库物理同步以及物理备份恢复，例如：配置项、位置信息、副本信息、日志流状态、备份恢复相关信息、合并信息等。 Meta 租户不可登录，普通用户只能通过系统租户的视图查询 Meta 租户下的数据。Meta 租户没有独立的 Unit，创建租户时默认为 Meta 租户预留资源，各项资源从用户租户资源中扣除。

用户租户与 Meta 租户是相关的概念，可以简单理解为：用户租户存放的都是与用户数据相关的信息，包括用户创建的表和部分系统表，这部分数据需要在主备集群之间同步，物理备份恢复也需要操作这部分数据；而 Meta 租户存放的都是支撑用户租户运行的集群私有数据，主备集群会各自创建自己的 Meta 租户，物理备份数据恢复出来的租户也会有自己的 Meta 租户，所以这部分数据不需要在主备集群之间同步，也不需要备份。系统租户与 Meta 租户类似，存放的是支撑集群运行的集群私有数据，同样无需主备集群之间同步及物理备份。

## 租户信息查询

DBA_OB_TENANTS 视图中存储了租户的相关信息，您可以登录系统租户，查询 DBA_OB_TENANTS 视图。视图中的 TENANT_TYPE 表示租户的类型，其中 SYS 为系统租户，META 为 Meta 租户，User 为用户租户。租户 ID 为 1 的是系统租户。租户 ID 大于 1000 的租户中，偶数的是用户租户，奇数的是 Meta 租户，并且用户租户的租户 ID 比其对应 Meta 租户大 1。示例如下：

以租户 mysql001 为例，ID 为 1002，与之相应的 Meta 租户就是 META$1002，ID 为 1001。

```sql
obclient [oceanbase]> select * from DBA_OB_TENANTS;
+-----------+-------------+-------------+----------------------------+----------------------------+-------------------+---------------------------------------------+-------------------+--------------------+--------+---------------+--------+
| TENANT_ID | TENANT_NAME | TENANT_TYPE | CREATE_TIME                | MODIFY_TIME                | PRIMARY_ZONE      | LOCALITY                                    | PREVIOUS_LOCALITY | COMPATIBILITY_MODE | STATUS | IN_RECYCLEBIN | LOCKED |
+-----------+-------------+-------------+----------------------------+----------------------------+-------------------+---------------------------------------------+-------------------+--------------------+--------+---------------+--------+
|         1 | sys         | SYS         | 2022-12-20 17:50:17.056814 | 2022-12-20 17:51:16.162367 | zone1;zone2;zone3 | FULL{1}@zone1, FULL{1}@zone2, FULL{1}@zone3 | NULL              | MYSQL              | NORMAL | NO            | NO     |
|      1001 | META$1002   | META        | 2022-12-20 18:04:31.683655 | 2023-01-06 14:40:57.872880 | zone1;zone2       | FULL{1}@zone1, FULL{1}@zone2, FULL{1}@zone3 | NULL              | MYSQL              | NORMAL | NO            | NO     |
|      1002 | mysql001    | USER        | 2022-12-20 18:04:31.689731 | 2023-01-06 14:40:57.872880 | zone1;zone2       | FULL{1}@zone1, FULL{1}@zone2, FULL{1}@zone3 | NULL              | MYSQL              | NORMAL | NO            | NO     |
|      1007 | META$1008   | META        | 2022-12-26 17:55:57.356089 | 2022-12-26 17:56:20.452948 | zone1;zone2;zone3 | FULL{1}@zone1, FULL{1}@zone2, FULL{1}@zone3 | NULL              | MYSQL              | NORMAL | NO            | NO     |
|      1008 | oracle002   | USER        | 2022-12-26 17:55:57.357098 | 2022-12-26 17:56:20.490809 | zone1;zone2;zone3 | FULL{1}@zone1, FULL{1}@zone2, FULL{1}@zone3 | NULL              | ORACLE             | NORMAL | NO            | NO     |
|      1009 | META$1010   | META        | 2022-12-26 18:28:38.055294 | 2022-12-26 18:29:01.184333 | zone1;zone2;zone3 | FULL{1}@zone1, FULL{1}@zone2, FULL{1}@zone3 | NULL              | MYSQL              | NORMAL | NO            | NO     |
|      1010 | oracle001   | USER        | 2022-12-26 18:28:38.056350 | 2022-12-26 18:29:01.223246 | zone1;zone2;zone3 | FULL{1}@zone1, FULL{1}@zone2, FULL{1}@zone3 | NULL              | ORACLE             | NORMAL | NO            | NO     |
+-----------+-------------+-------------+----------------------------+----------------------------+-------------------+---------------------------------------------+-------------------+--------------------+--------+---------------+--------+
9 rows in set
```

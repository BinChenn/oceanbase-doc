# 租户锁定和解锁

本文介绍如何进行租户锁定和解锁。

通过 `ALTER TENANT` 可以对租户进行锁定和解锁。

对租户进行锁定后，不能在该租户上创建新的连接，已有连接保持不变。如果是应急场景下锁定租户，锁定后需要主动 kill session。

## 租户锁定

1. 使用 root 用户登录到数据库的 sys 租户。

    ```sql
    $obclient -h172.30.xx.xx -P2883 -uroot@sys#cluster -p**** -A
    ```

2. 进入 OceanBase 数据库。

    ```sql
    obclient [(none)]> USE oceanbase;
    ```

3. 通过 `DBA_OB_TENANTS` 视图，查看租户信息。

   本示例查看租户 `mq_t1` 的锁定状态。

    ```sql
    obclient [oceanbase]> SELECT TENANT_ID,TENANT_NAME,LOCKED FROM DBA_OB_TENANTS WHERE TENANT_NAME = 'mq_t1';
    +-----------+-------------+--------+
    | TENANT_ID | TENANT_NAME | LOCKED |
    +-----------+-------------+--------+
    |      1036 | mq_t1       | NO     |
    +-----------+-------------+--------+
    1 row in set
    ```

    `DBA_OB_TENANTS` 视图的详细说明，请参见 [oceanbase.DBA_OB_TENANTS](../../../7.reference/5.system-reference/4.system-view-of-mysql-mode/2.dictionary-view-of-mysql-mode/58.oceanbase-dba_ob_tenants-of-mysql-mode.md)。

4. 通过 `ALTER TENANT` 语句，锁定 `mq_t1` 租户。

    ```sql
    obclient [oceanbase]> ALTER TENANT mq_t1 LOCK;
    Query OK, 0 rows affected
    ```

    `ALTER TENANT` 语句的详细说明，请参见 [ALTER TENANT](../../../7.reference/4.development-guide-refactoring/1.sql-syntax/1.system-tenants/5.alter-tenant.md)。

5. 查看 `DBA_OB_TENANTS` 视图，确认租户是否锁定成功。

    ```sql
    obclient [oceanbase]> SELECT TENANT_ID,TENANT_NAME,LOCKED FROM DBA_OB_TENANTS WHERE TENANT_NAME = 'mq_t1';
    +-----------+-------------+--------+
    | TENANT_ID | TENANT_NAME | LOCKED |
    +-----------+-------------+--------+
    |      1036 | mq_t1       | YES    |
    +-----------+-------------+--------+
    1 row in set
    ```

## 租户解锁

1. 使用 root 用户登录到数据库的 sys 租户。

    ```sql
    $obclient -h172.30.xx.xx -P2883 -uroot@sys#cluster -p**** -A
    ```

2. 进入 OceanBase 数据库。

    ```sql
    obclient [(none)]> USE oceanbase;
    ```

3. 通过 `DBA_OB_TENANTS` 视图，查看租户信息。

   本示例查看租户 `mq_t1` 的锁定状态。

    ```sql
    obclient [oceanbase]> SELECT TENANT_ID,TENANT_NAME,LOCKED FROM DBA_OB_TENANTS WHERE TENANT_NAME = 'mq_t1';
    +-----------+-------------+--------+
    | TENANT_ID | TENANT_NAME | LOCKED |
    +-----------+-------------+--------+
    |      1036 | mq_t1       | YES    |
    +-----------+-------------+--------+
    1 row in set
    ```

    `DBA_OB_TENANTS` 视图的详细说明，请参见 [oceanbase.DBA_OB_TENANTS](../../../7.reference/5.system-reference/4.system-view-of-mysql-mode/2.dictionary-view-of-mysql-mode/58.oceanbase-dba_ob_tenants-of-mysql-mode.md)。

4. 通过 `ALTER TENANT` 语句，解锁 `mq_t1` 租户。

    ```sql
    obclient [oceanbase]> ALTER TENANT mq_t1 UNLOCK;
    Query OK, 0 rows affected
    ```

    `ALTER TENANT` 语句的详细说明，请参见 [ALTER TENANT](../../../7.reference/4.development-guide-refactoring/1.sql-syntax/1.system-tenants/5.alter-tenant.md)。

5. 查看 `DBA_OB_TENANTS` 视图，确认租户是否锁定成功。

    ```sql
    obclient [oceanbase]> SELECT TENANT_ID,TENANT_NAME,LOCKED FROM DBA_OB_TENANTS WHERE TENANT_NAME = 'mq_t1';
    +-----------+-------------+--------+
    | TENANT_ID | TENANT_NAME | LOCKED |
    +-----------+-------------+--------+
    |      1036 | mq_t1       | NO     |
    +-----------+-------------+--------+
    1 row in set
    ```

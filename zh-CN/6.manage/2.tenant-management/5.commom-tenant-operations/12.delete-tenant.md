# 删除租户

本文介绍如何删除租户。

删除租户可以通过 `DROP TENANT` 语句进行。

删除租户后，租户下的数据库和表也同时被删除。但是租户使用的资源池不会被删除。资源池可以继续给其他租户使用。

* 当系统租户开启回收站功能时，`DROP TENANT` 操作表示删除的租户会进入回收站。对于回收站中的租户，后续系统租户可以通过租户级回收站功能进一步删除或恢复该租户，租户级回收站相关操作请参见 租户回收站。

* 当系统租户关闭回收站功能时，`DROP TENANT` 操作表示延迟删除租户，后台线程会进行 GC（Garbage Collection）动作，租户的信息仍然可以通过内部表查询。租户具体延迟删除的时间由配置项 `schema_history_expire_time` 控制，默认为 7 天，表示执行 `DROP TENANT` 7 天后，租户会被删除，租户下的数据库和表也同时被删除。

  `schema_history_expire_time` 配置项更多信息请参见 [schema_history_expire_time](../../../7.reference/5.system-reference/1.system-configuration-items/3.cluster-level-configuration-items/180.schema_history_expire_time.md)。

## 操作步骤

1. 使用 root 用户登录到数据库的 sys 租户。

    ```sql
    $obclient -h172.30.xx.xx -P2883 -uroot@sys#cluster -p**** -A
    ```

2. 进入 OceanBase 数据库。

    ```sql
    obclient [(none)]> USE oceanbase;
    ```

3. 通过 `DBA_OB_TENANTS` 视图，查看租户信息。根据租户的 ID、创建时间、资源分配等基本信息，确认是需要执行删除的租户。

   本示例中查询租户 `mq_t1` 的租户信息。

    ```sql
    obclient [oceanbase]> SELECT * FROM DBA_OB_TENANTS WHERE TENANT_NAME = 'mq_t1';
    +-----------+-------------+-------------+----------------------------+----------------------------+--------------+---------------------------------------------+-------------------+--------------------+--------+---------------+--------+
    | TENANT_ID | TENANT_NAME | TENANT_TYPE | CREATE_TIME                | MODIFY_TIME                | PRIMARY_ZONE | LOCALITY                                    | PREVIOUS_LOCALITY | COMPATIBILITY_MODE | STATUS | IN_RECYCLEBIN | LOCKED |
    +-----------+-------------+-------------+----------------------------+----------------------------+--------------+---------------------------------------------+-------------------+--------------------+--------+---------------+--------+
    |      1036 | mq_t1       | USER        | 2023-01-10 22:44:59.788717 | 2023-01-11 00:19:32.700572 | zone1,zone2  | FULL{1}@zone1, FULL{1}@zone2, FULL{1}@zone3 | NULL              | MYSQL              | NORMAL | NO            | NO     |
    +-----------+-------------+-------------+----------------------------+----------------------------+--------------+---------------------------------------------+-------------------+--------------------+--------+---------------+--------+
    1 row in set
    ```

    `DBA_OB_TENANTS` 视图的详细说明，请参见 [oceanbase.DBA_OB_TENANTS](../../../7.reference/5.system-reference/4.system-view-of-mysql-mode/2.dictionary-view-of-mysql-mode/58.oceanbase-dba_ob_tenants-of-mysql-mode.md)

4. （可选）OceanBase 数据库提供了租户级的回收站功能。在系统租户下可以通过 `SET GLOBAL recyclebin = ON;` 开启回收站功能，使用 `show recyclebin` 语句，可以查看当前系统租户回收站中的对象。

    回收站的详细说明，请参见 [回收站](../../../7.reference/1.oceanbase-database-concepts/10.high-data-reliability-and-availability/4.data-protection/4.recycle-bin.md)。

    <main id="notice" type='notice'>
     <h4>注意</h4>
     <p>修改全局变量时，需要退出后重新登录才能生效。</p>
    </main>

    ```sql
    SET GLOBAL recyclebin = ON; 
    
    # 重新登录

    obclient [oceanbase]> SHOW RECYCLEBIN;
    Empty set
    ```

5. 通过 `DROP TENANT` 语句，删除租户。

    ```sql
    DROP TENANT mq_t1;
    ```

    `DROP TENANT` 语句的详细说明，请参见 [DROP TENANT](../../../7.reference/4.development-guide-refactoring/1.sql-syntax/1.system-tenants/11.drop-tenant.md)。

6. 查看 `DBA_OB_TENANTS` 视图，确认租户已经删除成功。

    ```sql
    obclient [oceanbase]> SELECT * FROM DBA_OB_TENANTS WHERE TENANT_NAME = 'mq_t1';
    Empty set
    ```

7. （可选）在操作步骤 4 中如果开启了回收站功能，则可以通过 `SHOW RECYCLEBIN` 语句查看回收站中的信息。

    ```sql
    obclient [oceanbase]> SHOW RECYCLEBIN;
    +-------------------------------------+---------------+--------+----------------------------+
    | OBJECT_NAME                         | ORIGINAL_NAME | TYPE   | CREATETIME                 |
    +-------------------------------------+---------------+--------+----------------------------+
    | __recycle_$_100017_1673367572701376 | mq_t1         | TENANT | 2023-01-11 00:23:36.317242 |
    +-------------------------------------+---------------+--------+----------------------------+
    1 row in set
    ```

    回收站相关参数的详细说明，请参见 [recyclebin（MySQL 模式）](../../../7.reference/5.system-reference/2.system-variable-of-mysql-mode/113.recyclebin-of-mysql-mode.md)、[recyclebin（Oracle 模式）](../../../7.reference/5.system-reference/3.system-variable-of-oracle-mode/112.recyclebin-of-oracle-mode.md)。

## 更多信息

删除后若需要恢复租户，相关的更多信息，请参见：

* [恢复租户](13.restore-tenant.md)

* [回收站](../../../7.reference/1.oceanbase-database-concepts/10.high-data-reliability-and-availability/4.data-protection/4.recycle-bin.md)。

* [租户回收站](../../../7.reference/2.administrator-guide/5.backup-and-recovery/1.flashback/3.tenant-recycle.md)。
# 修改资源规格

修改资源规格，即是调整资源规格中的 CPU、Memory 等参数的值。本文介绍如何修改资源规格。

## 前提条件

在修改资源规格前，如果该资源规格正在被租户使用并且确认需要增加资源，则在增加资源的过程中必须保证 OBServer 有足够的剩余资源可用于分配。您可以通过 `GV$OB_SERVERS` 视图来查询节点总资源和已经分配的资源，然后通过计算来确定是否可以修改资源规格。`GV$OB_SERVERS` 视图详细介绍，请参见 [oceanbase.GV$OB_SERVERS](../../../7.reference/5.system-reference/4.system-view-of-mysql-mode/3.performance-view-of-mysql-mode/13.gv-ob_units-of-mysql-mode.md)。

## 操作步骤

1. 使用 root 用户登录到数据库的 sys 租户。

    ```sql
    $obclient -h172.30.xx.xx -P2883 -uroot@sys#cluster -p**** -A
    ```

2. 进入 OceanBase 数据库。

    ```sql
    obclient [(none)]> USE oceanbase;
    ```

3. 通过 `DBA_OB_UNIT_CONFIGS` 视图，获取资源规格的配置信息。

   本示例中查询资源单元 `S1_unit_config` 的配置信息。

    ```sql
    obclient [oceanbase]> SELECT * FROM DBA_OB_UNIT_CONFIGS WHERE NAME = 'S1_unit_config';
    +----------------+----------------+----------------------------+----------------------------+---------+---------+-------------+---------------+----------+----------+-------------+
    | UNIT_CONFIG_ID | NAME           | CREATE_TIME                | MODIFY_TIME                | MAX_CPU | MIN_CPU | MEMORY_SIZE | LOG_DISK_SIZE | MAX_IOPS | MIN_IOPS | IOPS_WEIGHT |
    +----------------+----------------+----------------------------+----------------------------+---------+---------+-------------+---------------+----------+----------+-------------+
    |           1020 | S1_unit_config | 2023-01-10 22:31:38.805862 | 2023-01-10 22:31:38.805862 |       1 |       1 |  2147483648 |    6442450944 |    10000 |    10000 |           1 |
    +----------------+----------------+----------------------------+----------------------------+---------+---------+-------------+---------------+----------+----------+-------------+
    1 row in set
    ```
  
    该视图的详细说明，请参见 [oceanbase.DBA_OB_UNIT_CONFIGS](../../../7.reference/5.system-reference/4.system-view-of-mysql-mode/2.dictionary-view-of-mysql-mode/60.oceanbase-dba_ob_unit_configs-of-mysql-mode.md)。

4. 通过 ALTER RESOURCE UNIT 语句，修改资源规格 `S1_unit_config` 的 MAX_CPU 为 2，MEMORY_SIZE 为 4G。

    ```sql
    obclient [oceanbase]> ALTER RESOURCE UNIT S1_unit_config MAX_CPU 2, MEMORY_SIZE '4G';
    Query OK, 0 rows affected
    ```

    `ALTER RESOURCE UNIT` 语句的详细说明，请参见 [ALTER RESOURCE UNIT](../../../7.reference/4.development-guide-refactoring/1.sql-syntax/1.system-tenants/4.alter-resource-unit.md)。

5. 查看 `DBA_OB_UNIT_CONFIGS` 视图，确认资源规格配置修改完成。

    ```sql  
    obclient [oceanbase]> SELECT * FROM DBA_OB_UNIT_CONFIGS WHERE NAME = 'S1_unit_config';
    +----------------+----------------+----------------------------+----------------------------+---------+---------+-------------+---------------+----------+----------+-------------+
    | UNIT_CONFIG_ID | NAME           | CREATE_TIME                | MODIFY_TIME                | MAX_CPU | MIN_CPU | MEMORY_SIZE | LOG_DISK_SIZE | MAX_IOPS | MIN_IOPS | IOPS_WEIGHT |
    +----------------+----------------+----------------------------+----------------------------+---------+---------+-------------+---------------+----------+----------+-------------+
    |           1020 | S1_unit_config | 2023-01-10 22:31:38.805862 | 2023-01-10 23:46:33.010251 |       2 |       1 |  4294967296 |    6442450944 |    10000 |    10000 |           1 |
    +----------------+----------------+----------------------------+----------------------------+---------+---------+-------------+---------------+----------+----------+-------------+
    1 row in set
    ```

    <main id="notice" type='notice'>
        <h4>注意</h4>
        <p>如果是租户已经在使用的资源规格，实际修改生效的情况需要通过视图 GV$OB_UNITS 查看对应租户的 Unit 是否完成规格修改。因为修改规格是异步的过程，真正生效需要由各个 Server 决定。</p>
    </main>
# 修改 Locality

OceanBase 数据库支持修改租户的 Locality 属性。

## 修改 Locality 语法

修改 Locality 语法如下：

```sql
ALTER TENANT 'TENANT_NAME' SET LOCALITY = 'locality_description';
```

## 前提条件

变更 Locality 之前，需要确认待变更的 Zone 上资源单元和资源池的状态。如果 Zone 上的 OBServer 资源不足导致无法存放租户需要的资源单元，则将导致无法进行 Locality 变更。

## 注意事项

* 租户的 Locality 不可以为空。

* 当租户的 Locality 发生变更时，在该租户下，所有表的副本分布情况也会随之变化。

* 在旧一轮租户 Locality 没有完成变更时，新一轮的租户 Locality 变更不允许被执行。

## 操作步骤

示例：
将租户 mq_t1 的 Locality 修改为 `F{1}@sa128_obv4_1,F{1}@sa128_obv4_2,F{1}@sa128_obv4_3`。

1. 使用 root 用户登录到数据库的 sys 租户。

   ```sql
   obclient -h172.30.xxx.xxx -P2883 -uroot@sys -pxxxx -A
   ```

2. 修改租户 mq_t1 的 Locality 。

   ```sql
   obclient>ALTER TENANT mq_t1 locality="F{1}@sa128_obv4_1,F{1}@sa128_obv4_2,F{1}@sa128_obv4_3";
   ```

3. 查看 Locality 变更任务的执行状态。

   ```sql
    obclient>select * from oceanbase.DBA_OB_TENANT_JOBS where JOB_TYPE = 'ALTER_TENANT_LOCALITY';
    +--------+-----------------------+------------+-------------+----------+----------------------------+----------------------------+-----------+------------------------------------------------------------------------------+---------------------------------------------+----------------+-------------+
    | JOB_ID | JOB_TYPE              | JOB_STATUS | RESULT_CODE | PROGRESS | START_TIME                 | MODIFY_TIME                | TENANT_ID | SQL_TEXT                                                                     | EXTRA_INFO                                  | RS_SVR_IP      | RS_SVR_PORT |
    +--------+-----------------------+------------+-------------+----------+----------------------------+----------------------------+-----------+------------------------------------------------------------------------------+---------------------------------------------+----------------+-------------+
    |      1 | ALTER_TENANT_LOCALITY | SUCCESS    |           0 |      100 | 2023-01-05 19:33:46.730319 | 2023-01-05 19:33:46.920111 |      1002 | ALTER TENANT mq_t1 locality="F{1}@sa128_obv4_1,F{1}@sa128_obv4_2,F{1}@sa128_obv4_3"                | FULL{1}@sa128_obv4_1, FULL{1}@sa128_obv4_2 | xx.xx.xx.xx |        2882 |
    +--------+-----------------------+------------+-------------+----------+----------------------------+----------------------------+-----------+------------------------------------------------------------------------------+---------------------------------------------+----------------+-------------+
   ```

   当 `JOB_STATUS` 为 `SUCCESS` 时，则说明 Locality 变更任务执行成功。

# 开启方式

OBServer 传输加密的开启通过多个配置项配合使用。

1. 指定私钥/证书/CA 证书的获取方式。

   本地文件模式

   ```sql
   alter system set ssl_external_kms_info = '
   {
   "ssl_mode":"file"
   }';
   ```

   或者

   ```sql
   alter system set ssl_external_kms_info = '';
   ```

   BKMI 模式

   ```sql
   alter system set ssl_external_kms_info = '
   {
   "ssl_mode":"bkmi",
   "kms_host":"http://xxx",  bkmi主站的url
   "root_cert": CA证书内容
   "private_key": bkmi分配给用户的应用身份私钥，用来解密从bkmi获取的加密的应用私钥
   "PRIVATE_KEY_PHRASE":"123456", bkmi分配给用户的应用身份私钥的解密密码
   "SCENE":"ANT", 应用场景
   "CALLER":"xxx", 进行服务调用的用户名，由bkmi分配
   "CERT_NAME":"xxx", 用户证书的名称
   "PRIVATE_KEY_NAME":"xxx", 用户私钥的名称
   "KEY_VERSION":"1"
   }';
   ```

2. 配置对应协议的 SSL 使能。

   ```sql
   alter system set ssl_client_authentication = 'TRUE';
   配置为TRUE后，mysql通信ssl即时开启
   ```

3. 配置 RPC 通信的 SSL 白名单，由于 OBServer 之间 TCP 连接都是长连接，因此需要重启 OBServer 后 RPC SSL 加密通信才能开启。

   ```sql
   rpc通信ssl需要配置白名单
   alter system set _ob_ssl_invited_nodes='ALL'; 整个集群都开启
   alter system set _ob_ssl_invited_nodes='123.12.21.12, 128.191.11.12'; 指定ip的observer开启
   ssl
   ```

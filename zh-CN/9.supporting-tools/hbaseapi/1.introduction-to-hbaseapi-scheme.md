# HBaseAPI 方案介绍

HBaseAPI 通过 HBase 兼容的 API 和合适的存储模型，使 HBase 业务可以平滑迁移到 OceanBase。

## 背景信息

OceanBase 的 HBaseAPI 客户端基于 TableAPI 提供的基本接口，在客户端封装了 HBase 兼容的 API 接口（目前已兼容 HBase 0.94 版本的特性）。若您当前有业务使用了原生 HBase 数据操作逻辑，您可以通过安装 OB 集群，在 OBServer 服务端建立 HBase Table，并通过 HBaseAPI 进行数据操作。
**说明**
关于 TableAPI 的方案介绍，用户可参考 [TableAPI方案介绍](https://open.oceanbase.com/docs/observer-cn/V3.1.1/10000000000013926)。
欢迎您到我们 [OceanBase GitHub网站](https://github.com/oceanbase) 上体验OBKV的客户端使用：

+ TableAPI 使用请参考：[Simple TableAPI Demo](https://github.com/oceanbase/obkv-table-client-java/tree/master/example)
+ HBaseAPI 使用请参考：[Simple HBaseAPI Demo](https://github.com/oceanbase/obkv-hbase-client-java/tree/main/example/simple-hbase-demo)

如果您想对 HBase 有更深入的了解，请参考 [Apache HBase 官方网站](https://hbase.apache.org/)、[Apache HBase interface 接口](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html)。

## HBaseAPI存储模型

您可以使用宽表模型（WideColumn）对数据建模，以便更好的兼容 HBase 的数据及后续通过 HBaseAPI 维护。具体操作，请参考 [HBaseAPI 存储模型](../2.hbaseapi-storage-model)。
如果您想了解 HBase 存储模型的详细内容，请参考 [Apache HBase数据模型](http://hbase.apache.org/0.94/book/datamodel.html)。

## HBaseAPI 客户端

您可以通过HBaseAPI 客户端，使用 HBase 兼容的 API 进行数据处理，具体操作，请参考 [HBaseAPI 客户端使用介绍](3.use-of-the-hbaseapi-client.md)。

以下是 HBaseAPI 的相关功能说明：

### 客户端线程池模型

HBaseAPI 提供 table pool 池化模式管理多个 table 的操作实例，目前资源池包含有 Reusable、RoundRobin 和 ThreadLoca 三种方式。用户可以在实例化 table pool 时指定使用某种模式。

### 路由表预热

支持在集群某台机器宕机时，客户端对指定 HBase table 的路由表信息进行刷新，避免造成服务暂停或服务无法访问。客户端也可以通过不定时预热操作，刷新集群的路由信息。

### 兼容性

HBaseAPI 客户端实现了 [HTableInterface](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/HTableInterface.html) 的接口，其接口的兼容性如下：
|Modifier and Type|Method and Description|compatibility|
|-|-|-|
|[Result](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Result.html)|[append](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#append(org.apache.hadoop.hbase.client.Append)) ([Append](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Append.html) append）<br>Appends values to one or more columns within a single row.|supported|
|[Object](https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true)[]|[batch](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#batch(java.util.List))([List](https://docs.oracle.com/javase/7/docs/api/java/util/List.html?is-external=true) <? extends [Row](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Row.html) > actions)Same as [batch(List, Object[])](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#batch(java.util.List,%20java.lang.Object[])), <br>but returns an array of results instead of using a results parameter reference.|not support|
|void|[batch](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#batch(java.util.List,%20java.lang.Object[]))( [List](https://docs.oracle.com/javase/7/docs/api/java/util/List.html?is-external=true) <? extends [Row](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Row.html) > actions, [Object](https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true)[] results)<br>Method that does a batch call on Deletes, Gets, Puts, Increments, Appends and RowMutations.|not support|
|boolean|[checkAndDelete](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#checkAndDelete(byte[],%20byte[],%20byte[],%20byte[],%20org.apache.hadoop.hbase.client.Delete))(byte[] row, byte[] family, byte[] qualifier, byte[] value,[Delete](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Delete.html)  delete)<br>Atomically checks if a row/family/qualifier value matches the expected value.|supported|
|boolean|[checkAndPut](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#checkAndPut(byte[],%20byte[],%20byte[],%20byte[],%20org.apache.hadoop.hbase.client.Put))(byte[] row, byte[] family, byte[] qualifier, byte[] value, [Put](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Put.html) put)<br>Atomically checks if a row/family/qualifier value matches the expected value.|supported|
|void|[close](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#close())<br>Releases any resources help or pending changes in internal buffers.|supported|
|***\<T extendsCoprocessorProtocol,R>Map\<byte[],R>|coprocessorExec(Class<T> protocol, byte[] startKey, byte[] endKey, Batch.Call<T,R> callable)<br>Invoke the passed Batch.Call against the CoprocessorProtocol instances running in the selected regions.|not support|
|***\<T extendsCoprocessorProtocol,R> void|coprocessorExec(Class\<T> protocol, byte[] startKey, byte[] endKey,Batch.Call\<T,R> callable,Batch.Callback\<R> callback)<br>Invoke the passed Batch.Call against the CoprocessorProtocol instances running in the selected regions.|not support|
|***\<T extends CoprocessorProtocol> T|coprocessorProxy(Class\<T> protocol, byte[] row)<br>Creates and returns a proxy to the CoprocessorProtocol instance running in the region containing the specified row.|not support|
|void|[delete](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#delete(org.apache.hadoop.hbase.client.Delete))([Delete](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Delete.html) delete)<br>Deletes the specified cells/row.|supported|
|void|[delete](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#delete(java.util.List))([List](https://docs.oracle.com/javase/7/docs/api/java/util/List.html?is-external=true)\<[Delete](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Delete.html)> deletes)<br>Deletes the specified cells/rows in bulk.|supported|
|boolean|[exists](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#exists(org.apache.hadoop.hbase.client.Get))([Get](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Get.html) get)<br>Test for the existence of columns in the table, as specified in the Get.|supported|
|***void|flushCommits()<br>Executes all the buffered Put operations.|supported|
|[Result](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Result.html)|[get](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#get(org.apache.hadoop.hbase.client.Get))([Get](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Get.html) get)<br>Extracts certain cells from a given row.|supported|
|[Result](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Result.html)[]|[get](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#get(java.util.List))([List](https://docs.oracle.com/javase/7/docs/api/java/util/List.html?is-external=true)\<[Get](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Get.html)> gets)<br>Extracts certain cells from the given rows, in batch.|supported|
|org.apache.hadoop.conf.Configuration|[getConfiguration](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#getConfiguration())()<br>Returns the Returns the Configuration object used by this instance.|supported|
|***Result|getRowOrBefore(byte[] row, byte[] family)Deprecated.As of version 0.92 this method is deprecated without replacement. getRowOrBefore is used internally to find entries in .META. and makes various assumptions about the table (which are true for .META. but not in general) to be efficient.|Deprecated|
|[ResultScanner](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/ResultScanner.html)|[getScanner](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#getScanner(byte[]))(byte[] family)<br>Gets a scanner on the current table for the given family.|supported|
|[ResultScanner](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/ResultScanner.html)|[getScanner](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#getScanner(byte[],%20byte[]))(byte[] family, byte[] qualifier)<br>Gets a scanner on the current table for the given family and qualifier.|supported|
|[ResultScanner](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/ResultScanner.html)|[getScanner](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#getScanner(org.apache.hadoop.hbase.client.Scan))([Scan](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Scan.html) scan)<br>Returns a scanner on the current table as specified by the [Scan](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Scan.html) object.|supported|
|[HTableDescriptor](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/HTableDescriptor.html)|[getTableDescriptor](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#getTableDescriptor())()<br>Gets the [table descriptor](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/HTableDescriptor.html) for this table.|not support|
|***byte[]|getTableName()<br>Gets the name of this table.|supported|
|***long|[getWriteBufferSize](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#getWriteBufferSize())()<br>Deprecated. as of 1.0.1 (should not have been in 1.0.0). [Replaced by BufferedMutator.getWriteBufferSize()](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/BufferedMutator.html#getWriteBufferSize())|supported|
|[Result](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Result.html)|[increment](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#increment(org.apache.hadoop.hbase.client.Increment))([Increment](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Increment.html)  increment)<br>Increments one or more columns within a single row.|supported|
|***long|[incrementColumnValue](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#incrementColumnValue(byte[],%20byte[],%20byte[],%20long))(byte[] row, byte[] family, byte[] qualifier, long amount)<br>See [incrementColumnValue(byte[], byte[], byte[], long, Durability)](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#incrementColumnValue(byte[],%20byte[],%20byte[],%20long,%20org.apache.hadoop.hbase.client.Durability))|supported|
|***long|[incrementColumnValue](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#incrementColumnValue(byte[],%20byte[],%20byte[],%20long,%20org.apache.hadoop.hbase.client.Durability))(byte[] row, byte[] family, byte[] qualifier, long amount, Durability durability)<br>Atomically increments a column value.|supported|
|***boolean|isAutoFlush()Tells whether or not 'auto-flush' is turned on.|partly supported|
|***RowLock|lockRow(byte[] row)<br>Deprecated.RowLock and associated operations are deprecated|Deprecated|
|void|[mutateRow](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#mutateRow(org.apache.hadoop.hbase.client.RowMutations))([RowMutations](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/RowMutations.html)  rm)<br>Performs multiple mutations atomically on a single row.|not support|
|void|[put](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#put(java.util.List))([List](https://docs.oracle.com/javase/7/docs/api/java/util/List.html?is-external=true)\<[Put](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Put.html)> puts)<br>Puts some data in the table, in batch.|supported|
|void|[put](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#put(org.apache.hadoop.hbase.client.Put))([Put](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Put.html)  put)<br>Puts some data in the table.|supported|
|***void|setAutoFlush(boolean autoFlush)<br>See setAutoFlush(boolean, boolean)|supported|
|***void|setAutoFlush(boolean autoFlush, boolean clearBufferOnFail)<br>Turns 'auto-flush' on or off.|supported|
|***void|[setWriteBufferSize](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/Table.html#setWriteBufferSize(long))(long writeBufferSize)<br>Deprecated. as of 1.0.1 (should not have been in 1.0.0). Replaced by [BufferedMutator](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/BufferedMutator.html) and [BufferedMutatorParams.writeBufferSize(long)](https://hbase.apache.org/1.1/apidocs/org/apache/hadoop/hbase/client/BufferedMutatorParams.html#writeBufferSize(long))|supported|
|***void|unlockRow(RowLock  rl)<br>Deprecated.RowLock and associated operations are deprecated|Deprecated|
